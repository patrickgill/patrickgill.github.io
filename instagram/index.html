<!--
helpers
https://regex101.com/r/yN9pZ6/1 
http://jsonpath.com/

-->


<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="favicon.ico">

    <title>Instagram</title>
    <!-- Bootstrap core CSS -->
    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>

    <!-- Begin page content -->
    <div class="container-fluid text-center">

      <div class="row bottom-buffer center-block text-center" id="header">
        <h2 class="defaultcursor">Instagram <span class="doubleclick">ðŸ˜…</span></h2>
      </div>

      <div class="row bottom-buffer text-center" id="helper">
        <small>Paste share link here</small>
        <br />
        <input id="url" type="text" style="width:480px" />
      </div>

      <div class="row bottom-buffer text-center">
        <input type="button" id="uploadBtn" value="Get download link" onclick="readURL();" />
      </div>

      <div class="row bottom-buffer text-center hidden" id="downloadrow">
        <h3><a id="download"></a></h3>
        <!-- copy button -->
      </div>

<!--       <br />
      <div class="row text-center output">
        <pre id="output"></pre>
      </div> -->

    </div>

    <footer>
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script> -->
    <script>window.jQuery || document.write('<script src="../js/jquery.min.js"><\/script>')</script>
    <script src="../js/bootstrap.min.js"></script>
    <script type="text/javascript" src="js/jquery.ajax-cross-origin.min.js"></script>
<script type="text/javascript">
window.onload=function(){
}

function readURL() {
  //   $("#helper").addClass('hidden');
  //   $("#imagerow").removeClass('hidden');
  //   $("#searchrow").removeClass('hidden');

  //   var Filename = document.getElementById("uploadBtn").value.split('/').pop().split('\\').pop();

  //   // document.getElementById("uploadFile").value = Filename;
  //   $("#uploadFile").text(Filename);
  //   $("#theimage").prop("alt", Filename);

  // var instagram_url = 'https://www.instagram.com/p/BJ2vYiuB3PV/?taken-by=borrowedmemes'
  var instagram_url = document.getElementById('url').value

    $.ajax({
      crossOrigin: true,
      url: instagram_url,
      success: function(data) {
        //window\._sharedData = (.*)?; // ig regex
        var igjson = data.match('window\._sharedData = (.*)?;')[1]
        var json = JSON.parse(igjson);

        // $('#output').text(igjson);
        // $('#output').text(igjson);

        // var video_url = jsonPath(igjson, "$..entry_data.PostPage[0].media.video_url").toJSONString() //jsonPath
        var video_url = json.entry_data.PostPage[0].media.video_url
        var pic_url = json.entry_data.PostPage[0].media.display_src

        if (json.entry_data.PostPage[0].media.is_video) {
          $('#downloadrow').removeClass('hidden');
          $('#download').attr('href',video_url);
          $('#download').text('Download MP4!');
        } else {
          if (pic_url) {
            $('#downloadrow').removeClass('hidden');
            $('#download').attr('href',pic_url);
            $('#download').text('Download!');
          }
        }
      }
    });
}

  // $.getJSON(instagram_url, function(data){
  //   $('#output').html(data.contents);
  // });

  // var el = document.createElement( 'html' );
  // // el.innerHTML = loadXMLDoc(document.getElementById("url").value)
  // el.innerHTML = loadXMLDoc(instagram_url)

// function loadXMLDoc(theURL)
// {
//     if (window.XMLHttpRequest)
//     {// code for IE7+, Firefox, Chrome, Opera, Safari, SeaMonkey
//         xmlhttp=new XMLHttpRequest();
//     }
//     else
//     {// code for IE6, IE5
//         xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
//     }
//     xmlhttp.onreadystatechange=function()
//     {
//         if (xmlhttp.readyState==4 && xmlhttp.status==200)
//         {
//             alert(xmlhttp.responseText);
//         }
//     }
//     xmlhttp.open("GET", theURL, false);
//     xmlhttp.send();
// }

//resize
// function resize() {
//   $(canvas).prop('width', 100)
//   $(canvas).prop('height', 100)
// }

// $( ".doubleclick" ).dblclick(function() {
//   // alert( "Handler for .dblclick() called." );
//   $( "#uploadBtn" ).trigger( "click" );
// });

</script>
  </body>
</html>
